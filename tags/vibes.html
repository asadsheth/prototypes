<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta property="og:title" content="doop doop doop" />
    <meta property="og:type" content="article" />
    <meta property="og:image" content="<?php echo $OG_IMAGE_BORROWED; ?>" />
	<style>
body{
	margin: 0;
	background: #ddd;
	font-family: sans-serif;
	font-size: 15px;
}

a {
	text-decoration: none;
	color: inherit;
}

div.vibe_button {
	font-size: 35px;
	margin: 35px;
	background: white;
	padding: 35px;
	box-sizing: border-box;
	border: 2px outset;
}

h1.vibe_header	{
	text-align: center;
	background: linear-gradient(45deg, blue, purple);
	height: 200px;
	line-height: 200px;
	font-size: 30px;
	color: white;
}

div.card {
	margin: 0px 0px 25px 0px;
	padding: 20px 0px 20px 0px;
	border-bottom: 1px solid #777;
	border-top: 1px solid #ccc;
	background: white;
	box-shadow: 0 0 20px 0 gray;
}

div.card_meta {

}

div.card_author {
	padding: 0px 20px;
	font-size: 12px;
	font-weight: bold;
}
div.card_author_avatar img {
	float: left;
	width: 25px;
	height: 25;
	border-radius: 13px;
	box-shadow: 0 0 10px 0 gray;
	margin-right: 10px;
}
div.card_author_avatar {

}
div.card_author_name {

}
div.card_timestamp {
	font-size: 10px;
	color: gray;
	padding: 0px 20px 0px 20px;
}

div.premise {
	padding: 0px 0px 0px 20px;
	margin: 20px 20px;
	border-left: 5px solid purple;
}

div.context {
}
div.context div.context_title {
	font-weight: bold;
	padding: 0px 20px;
	margin: 20px 0px 10px 0px;
	font-size: 30px;
}
div.context div.context_source {
	font-weight: normal;
	padding: 0px 20px;
	margin: 0px 0px;
	font-size: 10px;
}
img.context_image {
	width: 100%;
}

div.engagement {
	padding: 0px 20px;
	margin: 20px 0px;
	text-align: right;
}

div.reply {
	padding: 20px;
}
div.reply textarea {
	width: 100%;
	height: 59px;
	border: 1px solid gray;
	font-size: 14px;
	padding: 20px;
}

div.clear	{
	visibility: hidden;
	height: 0px;
	overflow: hidden;
	clear: both;
}
	</style>
</head>

<body>

</body>

<script>

var ALL_VIBES = [];

var COLORS = [
    'darkred',
    'darkgreen',
    'darkcyan',
    'darkblue',
    'darkgoldenrod',
    'darkslateblue',
    'darkviolet',
    'indigo',
    'darkmagenta',
    'firebrick',
    'green',
    'maroon',
    'midnightblue',
    'rebeccapurple'
];

document.addEventListener("DOMContentLoaded", function(event) {
	if(window.location.href.indexOf('allcomments') > -1)	{
		document.body.innerHTML = '';

		console.log('allcomments')
		var scr = document.createElement('script');
		scr.src = 'caches/c_allvibes.jsonp';
		document.head.appendChild(scr);
	}
	else {
		// get vibes from cached list
		load_vibe_list();
	}
});

function load_vibe_list() {
	// add script to head for jsonp
	var scr = document.createElement('script');
	scr.src = 'caches/all_vibes.jsonp';
	document.head.appendChild(scr);
}

function load_vibe(id) {
	// check if we're evaluating all comments for each vibe
	if(window.location.href.indexOf('evaluate') > -1)	{
		var scr = document.createElement('script');
		scr.src = 'caches/c_full_' + id + '.jsonp';
		document.head.appendChild(scr);
	}
	else {
		var scr = document.createElement('script');
		scr.src = 'caches/c_' + id + '.jsonp';
		document.head.appendChild(scr);
	}
}

function jsonp_parse_all_comments(obj) {
	console.log(obj);

    var theme_color = COLORS[Math.floor(Math.random() * COLORS.length)];
	document.body.className = 'vibe_comment_evaluator';

	for(var i = 0; i < obj.length; i++)	{
		// skip bot posts
		if(obj[i].bot) continue;

		var card = document.createElement('div');
		card.className = 'card';

		// card metadata
		var card_meta = document.createElement('div');
		card_meta.className = 'card_meta';
		var author = document.createElement('div');
		author.className = 'card_author';
		author.innerHTML = '<div class="card_author_avatar"><img src="' + obj[i].author_img + '"/></div>' + '<div class="card_author_name">' + obj[i].author_name + '</div>';
		card_meta.appendChild(author);
		var timestamp = document.createElement('div');
		timestamp.className = 'card_timestamp';
		// content time
		timestamp.innerHTML = obj[i].context_meta.content_relative_time + 'h';
		// comment time
		timestamp.innerHTML = obj[i].comment_relative_time + 'h';
		card_meta.appendChild(timestamp);
		card.appendChild(card_meta)

		// the premise of the comment
		var premise = document.createElement('div');
		premise.className = 'premise';
		premise.innerHTML = obj[i].text;
		premise.style.borderColor = theme_color;
		card.appendChild(premise);

		// the engagement
		var engagement = document.createElement('div');
		engagement.className = 'engagement';
		engagement.innerHTML = '&uarr; ' + obj[i].upvotes + '&nbsp; &nbsp; &nbsp; ' + '&darr; ' + obj[i].downvotes + '&nbsp; &nbsp; &nbsp; ' + '&#10150; ' + obj[i].replies;
		card.appendChild(engagement);

		// the context (the article)
		var context = document.createElement('div');
		context.className = 'context';
		context.style.fontSize = '10px !important';
		context.innerHTML = '<a tabindex="-1" href="' + obj[i].context_meta.link + '">'  + '<div class="context_title">' + obj[i].context_meta.title + '</div>' + '<div>' + obj[i].context_meta.vibe_name + '</div>' + '</a>';
		card.appendChild(context);

		document.body.appendChild(card);
	}	
}

function jsonp_parse_comment_list(obj) {
    var theme_color = COLORS[Math.floor(Math.random() * COLORS.length)];
	document.body.className = 'vibe_comment_evaluator';

	console.log(obj)

	for(var i = 0; i < obj.length; i++)	{
		// skip bot posts
		if(obj[i].bot) continue;

		var card = document.createElement('div');
		card.className = 'card';

		// card metadata
		var card_meta = document.createElement('div');
		card_meta.className = 'card_meta';
		var author = document.createElement('div');
		author.className = 'card_author';
		author.innerHTML = '<div class="card_author_avatar"><img src="' + obj[i].author_img + '"/></div>' + '<div class="card_author_name">' + obj[i].author_name + '</div>';
		card_meta.appendChild(author);
		var timestamp = document.createElement('div');
		timestamp.className = 'card_timestamp';
		// content time
		timestamp.innerHTML = obj[i].context_meta.content_relative_time + 'h';
		// comment time
		timestamp.innerHTML = obj[i].comment_relative_time + 'h';
		card_meta.appendChild(timestamp);
		card.appendChild(card_meta)

		// existing riposte
		if(false && obj[i].ripostes)	{
			var riposte = document.createElement('div');
			riposte.innerHTML = obj[i].ripostes.text;
			card.appendChild(riposte);
		}

		// the premise of the comment
		var premise = document.createElement('div');
		premise.className = 'premise';
		premise.innerHTML = obj[i].text;
		premise.style.borderColor = theme_color;
		card.appendChild(premise);

		// the engagement
		var engagement = document.createElement('div');
		engagement.className = 'engagement';
		engagement.innerHTML = '&uarr; ' + obj[i].upvotes + '&nbsp; &nbsp; &nbsp; ' + '&darr; ' + obj[i].downvotes + '&nbsp; &nbsp; &nbsp; ' + '&#10150; ' + obj[i].replies;
		card.appendChild(engagement);

		// the context (the article)
		var context = document.createElement('div');
		context.className = 'context';
		context.style.fontSize = '10px !important';
		context.innerHTML = '<a tabindex="-1" href="' + obj[i].context_meta.link + '">'  + '<div class="context_title">' + obj[i].context_meta.title + '</div>' + '</a>';
		card.appendChild(context);

		document.body.appendChild(card);
	}
}

function jsonp_parse_vibes(obj)	{
	ALL_VIBES = obj;

	for(var i = 0; i < ALL_VIBES.length; i++)	{
		var vibe_button = document.createElement('div');
		vibe_button.className = 'vibe_button';
		vibe_button.id = ALL_VIBES[i].id;
		vibe_button.name = ALL_VIBES[i].name;
		vibe_button.innerHTML = ALL_VIBES[i].name;
		vibe_button.onclick = function() {
			document.body.innerHTML = '<h1 class="vibe_header">' + this.name + '</h1>';

			load_vibe(this.id);
		}

		document.body.appendChild(vibe_button);
	}

}

function jsonp_parse_posts(obj) {
	console.log(obj);

    var theme_color = COLORS[Math.floor(Math.random() * COLORS.length)];

	for(var i = 0; i < obj.length; i++)	{
		var card = document.createElement('div');
		card.className = 'card';

		// card metadata
		var card_meta = document.createElement('div');
		card_meta.className = 'card_meta';
		var author = document.createElement('div');
		author.className = 'card_author';
		author.innerHTML = '<div class="card_author_avatar"><img src="' + obj[i].author_img + '"/></div>' + '<div class="card_author_name">' + obj[i].author_name + '</div>';
		card_meta.appendChild(author);
		var timestamp = document.createElement('div');
		timestamp.className = 'card_timestamp';
		// content time
		timestamp.innerHTML = obj[i].context_meta.content_relative_time + 'h';
		// comment time
		timestamp.innerHTML = obj[i].comment_relative_time + 'h';
		card_meta.appendChild(timestamp);
		card.appendChild(card_meta)

		// existing riposte
		if(false && obj[i].ripostes)	{
			var riposte = document.createElement('div');
			riposte.innerHTML = obj[i].ripostes.text;
			card.appendChild(riposte);
		}

		// the premise of the comment
		var premise = document.createElement('div');
		premise.className = 'premise';
		premise.innerHTML = obj[i].text;
		premise.style.borderColor = theme_color;
		card.appendChild(premise);

		// the context (the article)
		var context = document.createElement('div');
		context.className = 'context';
		context.innerHTML = '<a href="' + obj[i].context_meta.link + '">' + (obj[i].context_meta.img ? ('<img class="context_image" src="' + obj[i].context_meta.img + '"/>') : '') + '<div class="context_title">' + obj[i].context_meta.title + '</div>' + '<div class="context_source">' + obj[i].context_meta.provider + '</div>' + '</a>';
		card.appendChild(context);

		// the engagement
		var engagement = document.createElement('div');
		engagement.className = 'engagement';
		engagement.innerHTML = '&uarr; ' + obj[i].upvotes + '&nbsp; &nbsp; &nbsp; ' + '&darr; ' + obj[i].downvotes + '&nbsp; &nbsp; &nbsp; ' + '&#10150; ' + obj[i].replies;
		card.appendChild(engagement);

		// the reply
		var reply = document.createElement('div');
		reply.className = 'reply';
		reply.innerHTML = '<textarea placeholder="' + (obj[i].bot ? ('Start the conversation') : ('Reply to ' + obj[i].author_name)) + '&hellip;"></textarea>';
		card.appendChild(reply);

		document.body.appendChild(card);
	}
}
</script>

</html>